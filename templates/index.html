<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image → EN → JA</title>
  <link rel="stylesheet" href="{{ url_for('assets', filename='style.css') }}">
</head>
<body>

  <header class="header">
    <div class="title">Image Caption + Translation</div>
    <div class="subtitle">Upload an image and run the pipeline.</div>
  </header>

  <main class="container">

    <section class="card">
      <!-- ★ファイルアップロードなので enctype が必須 -->
      <form method="POST" id="runForm" class="form" enctype="multipart/form-data" autocomplete="off">
        <div class="field">
          <label for="image_file">Image file</label>
          <input
            id="image_file"
            type="file"
            name="image_file"
            accept=".jpg,.jpeg,.png,.webp"
          />
          <div class="hint">
            Supported: <code>.jpg .jpeg .png .webp</code>
          </div>
        </div>

        <div class="buttons">
          <button class="btn primary" type="submit" id="runBtn">Run</button>
          <button class="btn" type="button" id="clearBtn">Clear</button>
        </div>
      </form>
    </section>

    {% if error_message %}
      <section class="card error">
        <b>Error:</b> {{ error_message }}
      </section>
    {% endif %}

    <!-- ★POST後、保存できたときだけプレビュー -->
    {% if show_preview and image_path %}
      <section class="card">
        <div class="row">
          <div class="sectionTitle">Preview</div>
          <span class="badge">uploaded</span>
        </div>
        <img class="preview" src="/{{ image_path }}" alt="preview">
        <div class="hint" style="margin-top:8px;">
          <code>{{ image_path }}</code>
        </div>
      </section>
    {% endif %}

    <section class="card">
      <div class="row">
        <div class="sectionTitle">Output</div>
        {% if english_text or japanese_text %}
          <span class="badge">done</span>
        {% else %}
          <span class="badge">idle</span>
        {% endif %}
      </div>

      <div class="block">
        <div class="label">English</div>
        <div class="mono box">{{ english_text }}</div>
      </div>

      <div class="block">
        <div class="label">Japanese</div>
        <div class="mono box">{{ japanese_text }}</div>
      </div>
    </section>

  </main>

  <script src="{{ url_for('assets', filename='app.js') }}"></script>
</body>
</html>
